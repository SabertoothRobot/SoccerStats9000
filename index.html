<html>
<head>
<title>Soccer Stat Tracker</title>
<SCRIPT language="javascript">
		var playerNotesArray = [];
		var playerNoteRow;

		function addRow(tableID) {

			var table = document.getElementById(tableID);

			var rowCount = table.rows.length;
			var row = table.insertRow(rowCount);
			var cell0 = row.insertCell(0);
			var element0 = document.createElement("input");
			element0.className = "playerName";
			element0.type = "text";
			element0.name = "txtbox[]";
			cell0.appendChild(element0);

			var cell1 = row.insertCell(1);
			var element1 = document.createElement("input");
			element1.className = "playerGoal";
			element1.type = "text";
			element1.name = "txtbox[]";
			element1.size = "3";
			cell1.appendChild(element1);

			var cell2 = row.insertCell(2);
			var element2 = document.createElement("input");
			element2.className = "playerAssist";
			element2.type = "text";
			element2.name = "txtbox[]";
			element2.size = "3";
			cell2.appendChild(element2);

			var cell3 = row.insertCell(3);
			var element3 = document.createElement("input");
			element3.type = "button";
			element3.name = "notes";
			element3.value = "N";
			element3.onclick = function () {
				playerNoteRow = rowCount;
				showPlayerNote();
			};
			cell3.appendChild(element3);

		}
		function addGoalieRow(tableID) {

			var table = document.getElementById(tableID);

			var rowCount = table.rows.length;
			var row = table.insertRow(rowCount);
			var cell0 = row.insertCell(0);
			var element0 = document.createElement("input");
			element0.className = "goalieName";
			element0.type = "text";
			element0.name = "txtbox[]";
			cell0.appendChild(element0);

			var cell1 = row.insertCell(1);
			cell1.className = "goals";
			var element1 = document.createElement("input");
			element1.className = "goalieGoalsAllowed";
			element1.type = "text";
			element1.name = "txtbox[]";
			element1.size = "3";
			cell1.appendChild(element1);

			var cell2 = row.insertCell(2);
			cell2.className = "shots";
			var element2 = document.createElement("input");
			element2.className = "goalieShots";
			element2.type = "text";
			element2.name = "txtbox[]";
			element2.size = "3";
			cell2.appendChild(element2);

			var cell3 = row.insertCell(3);
			cell3.className = "cleanSheet";
			var element3 = document.createElement("input");
			element3.className = "goalieCleanSheet";
			element3.type = "text";
			element3.name = "txtbox[]";
			element3.size = "3";
			cell3.appendChild(element3);

		}
		function endGame() {
			var goalsFor = addUpGoalsFor();
			var goalsAgainst = addUpGoalsAgainst();
			document.getElementById("endOfGameDiv").innerHTML = "<h2>Game Summary</h2><p>Goals For:" + goalsFor + "</p> <p>Goals Against:" + goalsAgainst + "</p";
		}
		function addUpGoalsFor() {
			var totalGoals = 0;
			var els = document.getElementsByClassName("playerGoal");

			Array.prototype.forEach.call(els, function(el) {
				totalGoals = +totalGoals + +el.value;
			});
			return totalGoals;
		}
		function addUpGoalsAgainst() {
			var totalGoals = 0;
			var els = document.getElementsByClassName("goalieGoalsAllowed");

			Array.prototype.forEach.call(els, function(el) {
				totalGoals = +totalGoals + +el.value;
			});
			return totalGoals;
		}
		function showPlayerNote() {
			  var x = document.getElementById("mainDiv");
			  x.style.display = "none";
			  var y = document.getElementById("playerNotesDiv");
			  y.style.display = "block";
			  var z = document.getElementById("playerNotesText");
			  if(playerNotesArray[playerNoteRow] != "undefined") {
				  z.value = playerNotesArray[playerNoteRow]; 
			  }

		}
		function savePlayerNote() {
			  var x = document.getElementById("playerNotesDiv");
			  x.style.display = "none";
			  var y = document.getElementById("mainDiv");
			  y.style.display = "block";
			  var z = document.getElementById("playerNotesText");
			  playerNotesArray[playerNoteRow] = z.value;

		}
		function CreateCSV() {
			var filedata = "";
			var betweenTheThings = "\",\"";
			var pName = document.getElementsByClassName("playerName");
			var pGoal = document.getElementsByClassName("playerGoal");
			var pAssist = document.getElementsByClassName("playerAssist");
			var table = document.getElementById("playerTable");
			var rowCount = table.rows.length;
			var i;
			for (i = 0; i < table.rows.length - 1; i++) {
			  var j = i + 1;
			  var fileLine;
                          fileLine = "\"" + pName[i].value + betweenTheThings + pGoal[i].value + betweenTheThings + pAssist[i].value + betweenTheThings + playerNotesArray[j] + "\"\\n";
			  filedata = filedata + fileLine;
			}

			var gName = document.getElementsByClassName("goalieName");
			var gGoal = document.getElementsByClassName("goalieGoalsAllowed");
			var gShots = document.getElementsByClassName("goalieShots");
			var gCS = document.getElementsByClassName("goalieCleanSheet");
			var table = document.getElementById("goalieTable");
			var rowCount = table.rows.length;
			var i;
			for (i = 0; i < table.rows.length - 1; i++) {
			  var j = i + 1;
			  var fileLine;
                          fileLine = "\"" + gName[i].value + betweenTheThings + gGoal[i].value + betweenTheThings + gShots[i].value + betweenTheThings + gCS[i].value +  "\"\\n";
			  filedata = filedata + fileLine;
			}
			download(filedata, 'myfilename.csv', 'text/plain');
		}
		// Function to download data to a file
		function download(filedata, filename, type) {
		    var file = new Blob([filedata], {type: type});
		    if (window.navigator.msSaveOrOpenBlob) // IE10+
		        window.navigator.msSaveOrOpenBlob(file, filename);
		    else { // Others
		        var a = document.createElement("a"),
		                url = URL.createObjectURL(file);
		        a.href = url;
		        a.download = filename;
		        document.body.appendChild(a);
		        a.click();
		        setTimeout(function() {
				            document.body.removeChild(a);
		            window.URL.revokeObjectURL(url);  
		        }, 0); 
		    }
		}
	</SCRIPT>
	<style>
		h2, h3 {
 		   font-size: 36px;
		}
		body {
		    font: normal 26px Verdana, Arial, sans-serif;
		}
		input[type="text"]
		{
		    font-size:32px;
		}
		input[type="button"]
		{
		    font-size:32px;
		}
		textarea
		{
		    font-size:32px;
		}
	</style>
</head>
<body>
	<div id="mainDiv">
		<h2>Game Notes</h2>
		<table id="gameSummaryTable">
			<tr>
			<td>Opponent:</td>
			<td><INPUT type="text" size="20"></td>
			</tr>
			<tr>
			<td>Date:</td>
			<td><INPUT type="text" size="10"></td>
			</tr>
			<tr>
			<td>Weather:</td>
			<td><INPUT type="text" size="20"></td>
			</tr>
		</table>
		<h2>Players</h2>
		<table id="playerTable" width="100%">
		<tr>
			<th width="40%">Player</th>
			<th width="20%">Goals</th>
			<th width="20%">Assists</th>
			<th width="20%">Notes</th>
		</tr>
		</table>
		<INPUT type="button" value="Add Player" onclick="addRow('playerTable')" />
		<h2>Goalies</h2>
		<table id="goalieTable" width="100%">
		<tr>
			<th width="40%">Player</th>
			<th width="20%">Goals Allowed</th>
			<th width="20%">Shots</th>
			<th width="20%">CS</th>
		</tr>
		</table>
		<p><INPUT type="button" value="Add Goalie" onclick="addGoalieRow('goalieTable')" /></p>
		<br>
		<INPUT type="button" value="End Game" onclick="endGame()" />
		<div id="endOfGameDiv">	</div>
		<p><INPUT type="button" value="Download CSV" onclick="CreateCSV()" /></p>
	</div>
	<div id="playerNotesDiv" style="display: none;">
		<textarea id="playerNotesText" rows="10" cols="30" > </textarea>
		<br>
		<INPUT type="button" value="Save" onclick="savePlayerNote()" />
	</div>

	

</body>
</html>